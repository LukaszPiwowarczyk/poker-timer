<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Poker Timer - PRO</title>
<style>
  :root{
    --bg:#0b0b0b;
    --panel:#151515;
    --muted:#bdbdbd;
    --accent:#00ff80;
    --gold:#ffd700;
    --card:#e6e6e6;
    --card-contrast:#1a1a1a;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family: "Segoe UI", Roboto, system-ui, Arial;background:var(--bg);color:#fff}
  .app {
    max-width:1400px;
    margin:16px auto;
    border-radius:12px;
    overflow:hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.7);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    display:flex;
    flex-direction:column;
    min-height:80vh;
  }

  /* Header */
  header.app-header{
    padding:18px 24px;
    background:var(--panel);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  header.app-header h1{
    margin:0;font-size:22px;color:var(--accent);letter-spacing:2px;
  }
  header.app-header .subtitle{color:var(--muted);font-size:13px}

  /* main layout: left - settings, right - game */
  .main {
    display:flex;
    gap:0;
    min-height:calc(100% - 86px);
  }

  /* SETTINGS panel */
  .panel {
    padding:20px;
  }
  .settings {
    width:420px;
    background:var(--panel);
    border-right:1px solid rgba(255,255,255,0.02);
  }
  .settings h2{margin:0 0 8px 0;color:var(--accent);font-size:18px}
  label{display:block;color:var(--muted);margin-top:12px;font-size:13px}
  input[type="number"], input[type="text"]{
    width:100%;padding:10px 12px;margin-top:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#fff;font-size:16px
  }
  .row{display:flex;gap:8px}
  .row .col{flex:1}
  .btn{display:inline-block;padding:10px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700;margin-top:10px}
  .btn-primary{background:var(--accent);color:#000}
  .btn-ghost{background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.04)}
  .btn-danger{background:#ff4d4d;color:#fff}

  table{width:100%;border-collapse:collapse;margin-top:14px;color:#fff}
  th,td{padding:8px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.03);font-size:14px}
  th{color:var(--muted);font-weight:600}
  .levels-actions{display:flex;gap:8px;justify-content:center}

  /* GAME panel */
  .game {
    flex:1;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    padding:28px;
    gap:12px;
  }

  /* Stats cards row */
  .stats-row {
    display:flex;
    gap:16px;
    width:100%;
    justify-content:space-between;
    align-items:stretch;
    flex-wrap:wrap;
    margin-bottom:14px;
  }
  .card {
    background:var(--card);
    color:var(--card-contrast);
    padding:18px;
    border-radius:10px;
    flex:1 1 calc(25% - 16px);
    min-width:210px;
    position:relative;
    box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    display:flex;
    flex-direction:column;
    justify-content:space-between;
  }
  .card .title {
    display:flex;
    align-items:center;
    justify-content:space-between;
    font-weight:700;
    font-size:16px;
    color:var(--card-contrast);
    margin-bottom:8px;
  }
  .card .value {
    font-size:34px;
    font-weight:800;
  }
  .card .small {font-size:13px;color:rgba(0,0,0,0.6);font-weight:600}

  .svg-icon {
    width:28px;height:28px;opacity:0.75;
  }

  /* stat with buttons */
  .stat-controls {
    display:flex;gap:8px;align-items:center;
    font-size:26px;font-weight:800;
  }
  .stat-controls button {
    background:transparent;border:1px solid rgba(0,0,0,0.06);padding:6px 12px;border-radius:8px;cursor:pointer;font-size:22px;font-weight:700;
  }

  /* center large timer area */
  .timer-area {
    width:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:40px;
    flex-wrap:wrap;
  }
  .timer-card {
    background:transparent;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .round-timer {
    font-size:120px;
    font-weight:900;
    color:#fff;
    line-height:1;
    min-width:420px;
    text-align:center;
  }
  .break-timer {
    font-size:120px;
    font-weight:900;
    color:var(--gold);
    text-align:center;
    animation: pulse 1.3s ease-in-out infinite;
  }
  @keyframes pulse {
    0% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(255,215,0,0)); }
    50% { transform: scale(1.02); filter: drop-shadow(0 6px 26px rgba(255,215,0,0.12)); }
    100% { transform: scale(1); filter: drop-shadow(0 0 0 rgba(255,215,0,0)); }
  }

  .meta {
    margin-top:6px;color:var(--muted);font-size:16px;text-align:center;
  }

  /* controls row */
  .controls-row {display:flex;gap:12px;align-items:center;justify-content:center;margin-top:6px;flex-wrap:wrap}
  .controls-row .btn{font-size:18px;padding:12px 18px}

  /* small info row */
  .info-row {display:flex;gap:12px;align-items:center;justify-content:center;margin-top:10px;flex-wrap:wrap}
  .info-pill{background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:999px;color:var(--muted);font-weight:600}

  footer.note{margin-top:20px;color:var(--muted);font-size:13px}

  /* responsive */
  @media (max-width:1100px){
    .round-timer, .break-timer {font-size:82px;min-width:300px}
    .card .value {font-size:28px}
  }
  @media (max-width:820px){
    .main{flex-direction:column}
    .settings{width:100%}
    .stats-row {gap:12px}
    .card {flex:1 1 calc(50% - 12px)}
    .round-timer, .break-timer {font-size:64px;min-width:220px}
  }
  @media (max-width:480px){
    .card {padding:12px}
    .card .title{font-size:14px}
    .card .value{font-size:22px}
    .round-timer, .break-timer {font-size:44px;min-width:160px}
    .controls-row .btn{padding:10px 14px}
  }

  /* small helpers */
  .hidden{display:none}
  .muted{color:var(--muted);}
  .center{text-align:center}
</style>
</head>
<body>
<div class="app" role="application" aria-label="Poker Timer PRO">
  <header class="app-header">
    <div>
      <h1>POKER TIMER — PRO</h1>
      <div class="subtitle">Tryb: <span id="modeLabel">Ustawienia</span></div>
    </div>
    <div class="subtitle muted">Dostrojone pod duże ekrany • responsive</div>
  </header>

  <div class="main">
    <!-- SETTINGS -->
    <aside class="panel settings" id="settingsPanel" aria-labelledby="settingsTitle">
      <h2 id="settingsTitle">Ustawienia gry</h2>

      <label for="inputRoundMin">Czas rundy (minuty)</label>
      <input id="inputRoundMin" type="number" min="1" value="10">

      <div class="row">
        <div class="col">
          <label for="inputPlayers">Liczba graczy</label>
          <input id="inputPlayers" type="number" min="1" value="7">
        </div>
        <div class="col">
          <label for="inputStack">Stack początkowy</label>
          <input id="inputStack" type="number" min="1" value="200000">
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="inputRebuy">Wielkość Rebuy</label>
          <input id="inputRebuy" type="number" min="0" value="200000">
        </div>
        <div class="col">
          <label for="inputAddon">Wielkość Add-on</label>
          <input id="inputAddon" type="number" min="0" value="100000">
        </div>
      </div>

      <label for="inputInitialSmall">Początkowy Small Blind</label>
      <input id="inputInitialSmall" type="number" min="1" value="500">

      <label for="inputDefaultIncrement">Domyślny przyrost small (dla nowego poziomu)</label>
      <input id="inputDefaultIncrement" type="number" min="0" value="500">

      <div style="display:flex;gap:8px;margin-top:10px">
        <input id="inputAddIncrement" type="number" placeholder="Przyrost dla następnego poziomu" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.01);color:#fff">
        <button class="btn btn-primary" id="btnAddLevel">Dodaj poziom</button>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn btn-ghost" id="btnDefaults">Przywróć domyślne</button>
        <button class="btn btn-primary" id="btnStartGame">Start gry</button>
      </div>

      <h3 style="margin-top:16px;color:var(--muted)">Harmonogram poziomów</h3>
      <table id="levelsTable" aria-label="Tabela poziomów">
        <thead>
          <tr><th>Poziom</th><th>Small</th><th>Big</th><th>Przyrost</th><th>Akcje</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top:12px;color:var(--muted);font-size:13px">
        Dodaj poziomy wg potrzeb. Big = 2 × Small. Możesz edytować przyrosty w tabeli.
      </div>
    </aside>

    <!-- GAME -->
    <main class="panel game" id="gamePanel" aria-labelledby="gameTitle" style="display:none">
      <h2 id="gameTitle" class="center" style="margin:0 0 6px 0;color:var(--accent)">TRYB GRY</h2>

      <!-- four stat cards -->
      <div class="stats-row" role="region" aria-label="Statystyki gry">
        <!-- Chips in game -->
        <div class="card" aria-live="polite">
          <div class="title">
            <div>Żetony w grze</div>
            <!-- SVG coin stack -->
            <svg class="svg-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden>
              <ellipse cx="12" cy="6" rx="8" ry="3" stroke="currentColor" stroke-width="1.6" fill="none"></ellipse>
              <path d="M4 6v2c0 1.656 3.582 3 8 3s8-1.344 8-3V6" stroke="currentColor" stroke-width="1.6" fill="none"></path>
              <path d="M4 9v2c0 1.656 3.582 3 8 3s8-1.344 8-3v-2" stroke="currentColor" stroke-width="1.6" fill="none"></path>
            </svg>
          </div>
          <div class="value" id="chipsInGame">0</div>
          <div class="small">Suma wszystkich żetonów w grze</div>
        </div>

        <!-- Avg stack -->
        <div class="card">
          <div class="title">
            <div>Średni stack</div>
            <svg class="svg-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden>
              <rect x="3" y="3" width="18" height="4" rx="1" stroke="currentColor" stroke-width="1.6" fill="none"></rect>
              <rect x="3" y="9" width="14" height="4" rx="1" stroke="currentColor" stroke-width="1.6" fill="none"></rect>
              <rect x="3" y="15" width="10" height="4" rx="1" stroke="currentColor" stroke-width="1.6" fill="none"></rect>
            </svg>
          </div>
          <div class="value" id="avgStack">0</div>
          <div class="small">Średnia liczba żetonów na gracza</div>
        </div>

        <!-- Rebuys -->
        <div class="card">
          <div class="title">
            <div>Rebuys</div>
            <svg class="svg-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden>
              <path d="M20 7v6h-6" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M4 17v-6h6" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M20 7L12 15l-8-8" stroke="currentColor" stroke-width="1.2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="stat-controls">
            <button aria-label="Usuń rebuy" id="rebuyMinus">−</button>
            <div id="rebuyCount" class="value">0</div>
            <button aria-label="Dodaj rebuy" id="rebuyPlus">+</button>
          </div>
          <div class="small">Ilość dokonanych re-buy</div>
        </div>

        <!-- Add-ons -->
        <div class="card">
          <div class="title">
            <div>Add-ons</div>
            <svg class="svg-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden>
              <circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="1.6" fill="none"></circle>
              <path d="M12 8v8M8 12h8" stroke="currentColor" stroke-width="1.6" fill="none" stroke-linecap="round"></path>
            </svg>
          </div>
          <div class="stat-controls">
            <button aria-label="Usuń add-on" id="addonMinus">−</button>
            <div id="addonCount" class="value">0</div>
            <button aria-label="Dodaj add-on" id="addonPlus">+</button>
          </div>
          <div class="small">Ilość dokonanych add-on</div>
        </div>
      </div>

      <!-- Timer area -->
      <div class="timer-area" role="region" aria-label="Kontrola czasu">
        <div class="timer-card" aria-live="polite">
          <!-- If on break -> show break-timer; otherwise show round-timer -->
          <div id="roundTimerWrap">
            <div class="round-timer" id="roundTimer">10:00</div>
            <div class="meta" id="currentBlinds">Blindy: 500 / 1000 — Poziom 1 / 1</div>
          </div>

          <div id="breakTimerWrap" class="hidden">
            <div class="break-timer" id="breakTimer">PRZERWA 00:00</div>
            <div class="meta muted">Przerwa (wznowienie kontynuuje rundę)</div>
          </div>

          <div class="controls-row">
            <button class="btn btn-primary" id="btnStart">▶ Start</button>
            <button class="btn btn-ghost" id="btnPause">⏸️ Pauza</button>
            <button class="btn btn-ghost" id="btnNext">⏭ Następny poziom</button>
            <button class="btn btn-danger" id="btnReset">🔄 Reset</button>
            <button class="btn btn-ghost" id="btnFullscreen">⛶ Pełny ekran</button>
          </div>

          <div class="info-row" aria-hidden="false">
            <div class="info-pill">Czas gry: <strong id="totalTime">00:00</strong></div>
            <div class="info-pill">Suma przerw: <strong id="sumBreaks">00:00</strong></div>
            <div class="info-pill">Ostatnia runda start: <strong id="lastRoundStart">--:--</strong></div>
          </div>

          <footer class="note">Aplikacja zapisuje ustawienia w localStorage</footer>
        </div>
      </div>

    </main>
  </div>
</div>

<script>
/* Poker Timer PRO - One-file app
   - settings <> game
   - levels: [{small, increment}]
   - rebuys/addons counters
   - timers: round timer, total time, break timer(s)
   - save/load state to localStorage
*/

// --- Helpers ---
const $ = sel => document.querySelector(sel);
const $all = sel => Array.from(document.querySelectorAll(sel));
const formatTime = s => {
  const m = Math.floor(s/60);
  const sec = s%60;
  return `${m}:${String(sec).padStart(2,'0')}`;
};
const pad2 = n => String(n).padStart(2,'0');

// --- Elements ---
const settingsPanel = $('#settingsPanel');
const gamePanel = $('#gamePanel');
const modeLabel = $('#modeLabel');

const inputRoundMin = $('#inputRoundMin');
const inputPlayers = $('#inputPlayers');
const inputStack = $('#inputStack');
const inputRebuy = $('#inputRebuy');
const inputAddon = $('#inputAddon');
const inputInitialSmall = $('#inputInitialSmall');
const inputDefaultIncrement = $('#inputDefaultIncrement');
const inputAddIncrement = $('#inputAddIncrement');
const btnAddLevel = $('#btnAddLevel');
const btnDefaults = $('#btnDefaults');
const btnStartGame = $('#btnStartGame');
const levelsTableBody = $('#levelsTable tbody');

const chipsInGameEl = $('#chipsInGame');
const avgStackEl = $('#avgStack');
const rebuyCountEl = $('#rebuyCount');
const addonCountEl = $('#addonCount');

const rebuyMinus = $('#rebuyMinus'), rebuyPlus = $('#rebuyPlus');
const addonMinus = $('#addonMinus'), addonPlus = $('#addonPlus');

const roundTimerEl = $('#roundTimer');
const currentBlindsEl = $('#currentBlinds');
const btnStart = $('#btnStart');
const btnPause = $('#btnPause');
const btnNext = $('#btnNext');
const btnReset = $('#btnReset');
const btnFullscreen = $('#btnFullscreen');
const totalTimeEl = $('#totalTime');
const sumBreaksEl = $('#sumBreaks');
const lastRoundStartEl = $('#lastRoundStart');

const roundTimerWrap = $('#roundTimerWrap');
const breakTimerWrap = $('#breakTimerWrap');
const breakTimerEl = $('#breakTimer');

// --- State ---
let levels = []; // [{small:number, increment:number}]
let roundIndex = 0;
let roundSeconds = 0;
let timerInterval = null;

let totalSeconds = 0;
let totalTimerInterval = null;

let onBreak = false;
let breakSeconds = 0;
let breakInterval = null;
let sumBreakSeconds = 0;

let rebuyCount = 0;
let addonCount = 0;

let playersCount = 7, stackSize = 200000, rebuySize = 200000, addonSize = 100000;

// --- Persistence ---
const STORAGE_KEY = "poker_timer_pro_v1";
function saveState(){
  const s = {
    levels, roundIndex,
    inputRoundMin: inputRoundMin.value,
    playersCount, stackSize, rebuySize, addonSize,
    rebuyCount, addonCount,
    sumBreakSeconds, totalSeconds
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
}
function loadState(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return false;
  try{
    const s = JSON.parse(raw);
    if(Array.isArray(s.levels) && s.levels.length>0){
      levels = s.levels;
      roundIndex = s.roundIndex || 0;
      inputRoundMin.value = s.inputRoundMin || inputRoundMin.value;
      inputPlayers.value = s.playersCount || inputPlayers.value;
      inputStack.value = s.stackSize || inputStack.value;
      inputRebuy.value = s.rebuySize || inputRebuy.value;
      inputAddon.value = s.addonSize || inputAddon.value;
      rebuyCount = s.rebuyCount || 0;
      addonCount = s.addonCount || 0;
      sumBreakSeconds = s.sumBreakSeconds || 0;
      totalSeconds = s.totalSeconds || 0;
      // sync settings variables
      playersCount = parseInt(inputPlayers.value,10)||playersCount;
      stackSize = parseInt(inputStack.value,10)||stackSize;
      rebuySize = parseInt(inputRebuy.value,10)||rebuySize;
      addonSize = parseInt(inputAddon.value,10)||addonSize;
      return true;
    }
  }catch(e){console.warn(e)}
  return false;
}

// --- UI functions ---
function renderLevels(){
  levelsTableBody.innerHTML = '';
  levels.forEach((lvl,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i+1}</td>
      <td contenteditable="false">${lvl.small}</td>
      <td>${lvl.small*2}</td>
      <td><input type="number" data-idx="${i}" class="inc-input" value="${lvl.increment}" style="width:80px;padding:6px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff"></td>
      <td class="levels-actions">
        <button class="btn-ghost level-del" data-idx="${i}" title="Usuń">🗑️</button>
        <button class="btn-ghost level-up" data-idx="${i}" title="Przenieś w górę">↑</button>
        <button class="btn-ghost level-down" data-idx="${i}" title="Przenieś w dół">↓</button>
      </td>
    `;
    levelsTableBody.appendChild(tr);
  });
  // attach listeners
  $all('.inc-input').forEach(inp=>{
    inp.onchange = e=>{
      const idx = parseInt(e.target.dataset.idx,10);
      levels[idx].increment = parseInt(e.target.value,10) || 0;
      // recompute subsequent smalls
      for(let j=idx+1;j<levels.length;j++){
        levels[j].small = levels[j-1].small + (levels[j-1].increment||0);
      }
      saveState();
      renderLevels();
    };
  });
  $all('.level-del').forEach(btn=>{
    btn.onclick = e=>{
      const idx = parseInt(btn.dataset.idx,10);
      if(!confirm('Usunąć ten poziom?')) return;
      levels.splice(idx,1);
      if(roundIndex >= levels.length) roundIndex = Math.max(0, levels.length-1);
      saveState();
      renderLevels();
      updateCurrentBlinds();
    };
  });
  $all('.level-up').forEach(btn=>{
    btn.onclick = e=>{
      const idx = parseInt(btn.dataset.idx,10);
      if(idx<=0) return;
      [levels[idx-1], levels[idx]] = [levels[idx], levels[idx-1]];
      if(roundIndex===idx) roundIndex = idx-1;
      else if(roundIndex===idx-1) roundIndex = idx;
      saveState();
      renderLevels();
    };
  });
  $all('.level-down').forEach(btn=>{
    btn.onclick = e=>{
      const idx = parseInt(btn.dataset.idx,10);
      if(idx>=levels.length-1) return;
      [levels[idx], levels[idx+1]] = [levels[idx+1], levels[idx]];
      if(roundIndex===idx) roundIndex = idx+1;
      else if(roundIndex===idx+1) roundIndex = idx;
      saveState();
      renderLevels();
    };
  });
}

function updateStatsUI(){
  const total = playersCount * stackSize + rebuyCount * rebuySize + addonCount * addonSize;
  chipsInGameEl.textContent = total.toLocaleString('pl-PL');
  const avg = Math.floor(total / Math.max(1, playersCount));
  avgStackEl.textContent = avg.toLocaleString('pl-PL');
  rebuyCountEl.textContent = rebuyCount;
  addonCountEl.textContent = addonCount;
}

function updateCurrentBlinds(){
  if(levels.length===0){
    currentBlindsEl.textContent = 'Brak zdefiniowanych poziomów';
    return;
  }
  const lvl = levels[roundIndex];
  currentBlindsEl.textContent = `Blindy: ${lvl.small} / ${lvl.small*2} — Poziom ${roundIndex+1} / ${levels.length}`;
}

function computeLastRoundStart(){
  // Estimate start time of the last round from now:
  // sum remaining seconds for current round + remaining full rounds after current + sumBreakSeconds
  const roundLen = parseInt(inputRoundMin.value,10) * 60;
  // remaining seconds in current round = roundSeconds
  // if in break, current round remains paused; but we'll approximate: last round start = now + roundSeconds + (levelsLeft-1)*roundLen + sumBreakSeconds
  const levelsLeft = Math.max(0, levels.length - (roundIndex+1)); // rounds after current
  const secondsToLastStart = (roundSeconds) + (levelsLeft * roundLen) + sumBreakSeconds;
  const est = new Date(Date.now() + secondsToLastStart*1000);
  return `${pad2(est.getHours())}:${pad2(est.getMinutes())}`;
}

function updateTimeDisplays(){
  // round timer
  roundTimerEl.textContent = formatTime(roundSeconds);
  // total time
  totalTimeEl.textContent = formatTime(totalSeconds);
  // sum breaks
  sumBreaksEl.textContent = formatTime(sumBreakSeconds + (onBreak?breakSeconds:0));
  // last round start
  lastRoundStartEl.textContent = computeLastRoundStart();
}

// --- Actions: add level, defaults, start ---
btnAddLevel.onclick = ()=>{
  const last = levels.length?levels[levels.length-1]:null;
  const addInc = parseInt(inputAddIncrement.value,10);
  const inc = (Number.isFinite(addInc) && addInc>0) ? addInc : (parseInt(inputDefaultIncrement.value,10)||0);
  const newSmall = last ? (last.small + (last.increment||0)) : (parseInt(inputInitialSmall.value,10)||500);
  levels.push({small:newSmall, increment:inc});
  // recompute subsequent just in case
  for(let i=1;i<levels.length;i++){
    levels[i].small = levels[i-1].small + (levels[i-1].increment||0);
  }
  inputAddIncrement.value = '';
  saveState();
  renderLevels();
};

btnDefaults.onclick = ()=>{
  if(!confirm('Przywrócić domyślne ustawienia?')) return;
  inputRoundMin.value = 10;
  inputPlayers.value = 7;
  inputStack.value = 200000;
  inputRebuy.value = 200000;
  inputAddon.value = 100000;
  inputInitialSmall.value = 500;
  inputDefaultIncrement.value = 500;
  levels = [{small:500, increment:500}];
  roundIndex = 0;
  rebuyCount = 0; addonCount = 0;
  sumBreakSeconds = 0; totalSeconds = 0;
  saveState();
  renderLevels();
  updateStatsUI();
  updateCurrentBlinds();
};

btnStartGame.onclick = ()=>{
  // sync settings
  playersCount = parseInt(inputPlayers.value,10) || 1;
  stackSize = parseInt(inputStack.value,10) || 0;
  rebuySize = parseInt(inputRebuy.value,10) || 0;
  addonSize = parseInt(inputAddon.value,10) || 0;
  // ensure at least one level
  if(levels.length===0){
    levels.push({small: parseInt(inputInitialSmall.value,10)||500, increment: parseInt(inputDefaultIncrement.value,10)||500});
  } else {
    // update first small if user changed it
    levels[0].small = parseInt(inputInitialSmall.value,10) || levels[0].small;
    // recompute subsequent
    for(let i=1;i<levels.length;i++){
      levels[i].small = levels[i-1].small + (levels[i-1].increment||0);
    }
  }
  roundIndex = 0;
  roundSeconds = parseInt(inputRoundMin.value,10) * 60;
  // reset counters
  rebuyCount = 0; addonCount = 0; sumBreakSeconds = 0; totalSeconds = 0; breakSeconds = 0;
  saveState();
  // switch to game view
  settingsPanel.style.display = 'none';
  gamePanel.style.display = '';
  modeLabel.textContent = 'Gra';
  updateStatsUI();
  renderLevels();
  updateCurrentBlinds();
  updateTimeDisplays();
  startTotalTimer();
};

// --- Timer logic ---
function startRoundTimer(){
  if(timerInterval) return;
  timerInterval = setInterval(()=>{
    if(!onBreak){
      if(roundSeconds>0){
        roundSeconds--;
        updateTimeDisplays();
      } else {
        // round ended -> go next level or stop
        if(roundIndex < levels.length - 1){
          roundIndex++;
          roundSeconds = parseInt(inputRoundMin.value,10)*60;
          saveState();
          updateCurrentBlinds();
          updateTimeDisplays();
        } else {
          clearInterval(timerInterval);
          timerInterval = null;
          alert('Koniec harmonogramu poziomów!');
        }
      }
    }
  },1000);
}

function stopRoundTimer(){
  if(timerInterval){
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

// total time since start
function startTotalTimer(){
  if(totalTimerInterval) return;
  totalTimerInterval = setInterval(()=>{
    totalSeconds++;
    updateTimeDisplays();
  },1000);
}
function stopTotalTimer(){
  if(totalTimerInterval){ clearInterval(totalTimerInterval); totalTimerInterval=null;}
}

// break handling
function startBreak(){
  onBreak = true;
  breakSeconds = 0;
  roundTimerWrap.classList.add('hidden');
  breakTimerWrap.classList.remove('hidden');
  // break interval
  if(breakInterval) clearInterval(breakInterval);
  breakInterval = setInterval(()=>{
    breakSeconds++;
    breakTimerEl.textContent = `PRZERWA ${formatTime(breakSeconds)}`;
    updateTimeDisplays();
  },1000);
}
function endBreak(){
  onBreak = false;
  // accumulate break into sum
  sumBreakSeconds += breakSeconds;
  breakSeconds = 0;
  if(breakInterval){ clearInterval(breakInterval); breakInterval = null;}
  breakTimerWrap.classList.add('hidden');
  roundTimerWrap.classList.remove('hidden');
  updateTimeDisplays();
  saveState();
}

// Pause/wznów button
btnPause.onclick = ()=>{
  if(!timerInterval) {
    // if timer not running, start it
    btnStart.click();
    return;
  }
  if(!onBreak){
    // start break (pause round timer)
    startBreak();
    btnPause.textContent = '▶️ Wznów';
  } else {
    // end break -> resume
    endBreak();
    btnPause.textContent = '⏸️ Pauza';
  }
};

// Start button
btnStart.onclick = ()=>{
  // if timer not running, start round timer
  if(!timerInterval) {
    // ensure roundSeconds is set
    if(!roundSeconds || roundSeconds<=0) roundSeconds = parseInt(inputRoundMin.value,10)*60;
    startRoundTimer();
    startTotalTimer();
  }
};

// Next level
btnNext.onclick = ()=>{
  if(roundIndex < levels.length - 1){
    roundIndex++;
    roundSeconds = parseInt(inputRoundMin.value,10)*60;
    updateCurrentBlinds();
    saveState();
    updateTimeDisplays();
  } else {
    alert('Brak kolejnych poziomów.');
  }
};

// Reset -> confirm and go back to settings
btnReset.onclick = ()=>{
  if(!confirm('Czy na pewno zresetować grę i wrócić do ustawień?')) return;
  // stop timers
  stopRoundTimer();
  stopTotalTimer();
  if(breakInterval) { clearInterval(breakInterval); breakInterval = null; }
  onBreak = false; breakSeconds = 0;
  // keep levels but reset round index and counters
  roundIndex = 0;
  roundSeconds = parseInt(inputRoundMin.value,10)*60;
  rebuyCount = 0; addonCount = 0; sumBreakSeconds = 0; totalSeconds = 0;
  saveState();
  // show settings panel
  settingsPanel.style.display = '';
  gamePanel.style.display = 'none';
  modeLabel.textContent = 'Ustawienia';
  updateStatsUI();
  renderLevels();
  updateCurrentBlinds();
  updateTimeDisplays();
  btnPause.textContent = '⏸️ Pauza';
};

// full screen
btnFullscreen.onclick = ()=>{
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen().catch(()=>{});
  } else {
    document.exitFullscreen();
  }
};

// rebuys/addons controls
rebuyPlus.onclick = ()=>{ rebuyCount++; updateStatsUI(); saveState(); };
rebuyMinus.onclick = ()=>{ rebuyCount = Math.max(0, rebuyCount-1); updateStatsUI(); saveState(); };
addonPlus.onclick = ()=>{ addonCount++; updateStatsUI(); saveState(); };
addonMinus.onclick = ()=>{ addonCount = Math.max(0, addonCount-1); updateStatsUI(); saveState(); };

// --- Initialization ---
(function init(){
  const loaded = loadState();
  if(!loaded){
    // defaults
    levels = [{small:500, increment:500}];
    roundIndex = 0;
  }
  // populate settings inputs with state
  inputPlayers.value = playersCount;
  inputStack.value = stackSize;
  inputRebuy.value = rebuySize;
  inputAddon.value = addonSize;
  inputInitialSmall.value = levels[0].small;
  inputDefaultIncrement.value = levels[0].increment || inputDefaultIncrement.value;

  // initial timers
  roundSeconds = parseInt(inputRoundMin.value,10) * 60;

  renderLevels();
  updateStatsUI();
  updateCurrentBlinds();
  updateTimeDisplays();

  // If there was ongoing totalSeconds in saved state, resume total timer
  if(totalSeconds>0) startTotalTimer();
  // show settings by default
  settingsPanel.style.display = '';
  gamePanel.style.display = 'none';
})();

window.addEventListener('beforeunload', ()=>{ saveState(); });

</script>
</body>
</html>
